<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Places API Example with CSV</title>

  <!-- Google Maps API script with your API key -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCdKwRyfcuOal37Pudu0rUs1bTRJgKgaWg&libraries=places"></script>

  <script>
    function initMap(lat, lng) {
      // Create a new PlacesService instance attached to a temporary div
      const service = new google.maps.places.PlacesService(document.createElement('div'));
      // Define the location coordinates (latitude and longitude)
      const latLng = { lat: lat, lng: lng };

      // Create a request object for nearby places search
      const request = {
        location: latLng,
        radius: '500', // Search within 500 meters
        types: ['restaurant', 'bakery', 'bar', 'school', 'store'] // Types of places to search
      };

      // Perform a nearby search using the Google Places API
      service.nearbySearch(request, (results, status) => {
        // Check if the request was successful
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          results.forEach(place => {
            // If results exist, iterate over them and log the details
            console.log(`Place Name: ${place.name}`);
            console.log(`Place Types: ${place.types}`);
          });
        } else {
          // Log an error message if the API request fails
          console.error('PlacesService error:', status);
        }
      });
    }

    // Read CSV file and convert to JSON
    function csvJSON(csv) {
      var lines = csv.split("\n");
      var result = [];
      var headers = lines[0].split(",");

      for (var i = 1; i < lines.length; i++) {
        var obj = {};
        var currentline = lines[i].split(",");

        for (var j = 0; j < headers.length; j++) {
          obj[headers[j]] = currentline[j];
        }
        result.push(obj);
      }

      return result; // Returning JavaScript object (array of objects)
    }

    // Handle the file upload and parsing
    document.addEventListener('DOMContentLoaded', function () {
      const fileInput = document.getElementById('csvFileInput');
      const convertBtn = document.getElementById('convertBtn');

      convertBtn.addEventListener('click', function () {
        const input = fileInput.files[0];

        if (input && input.name === "FakeLocationData.csv") {
          const reader = new FileReader();
          reader.onload = function (e) {
            const csv = e.target.result;
            const jsonData = csvJSON(csv);

            // Assuming 'latitude' and 'longitude' are headers in your CSV file
            jsonData.forEach(location => {
              const lat = parseFloat(location.Lat);
              const lng = parseFloat(location.Long);

              // Call the initMap function with each location from the CSV
              initMap(lat, lng);
            });
          };

          reader.readAsText(input);
        } else {
          alert('Please upload FakeLocationData.csv.');
         }
      });
    });
  </script>
</head>

<body>
  <h1>Google Places Nearby Search with CSV</h1>

  <!-- File input to load the CSV -->
  <input type="file" id="csvFileInput" accept=".csv" />

  <!-- Button to trigger the conversion and place search -->
  <button id="convertBtn">Convert CSV and Search Places</button>
</body>

</html>
